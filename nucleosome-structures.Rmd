---
title: "Nucleosome structures"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
```

**Last updated on `r date()`.**

## How to re-use this work

If you use the following figures in your own work, please cite:

- Zhou K, Gaullier G & Luger K (2019) Nucleosome structure and dynamics are
  coming of age. *Nature Structural & Molecular Biology* **26**: 3â€“13.
  <https://doi.org/10.1038/s41594-018-0166-x>
- This website: <https://doi.org/10.5281/zenodo.3470119>

## Nucleosome structures by year

All figures are interactive (you can zoom in, and hovering over elements will
show more information).

```{r Download and clean up data, make figure}
# Load required packages
library(magrittr)
library(dplyr)
library(purrr)
library(jsonlite)
library(forcats)
library(ggplot2)
library(plotly)
library(here)
library(stringr)

# We need two queries: one for uppercase titles, the other for lowercase ones
pdb_queries <- c(
    uppercase = 'https://www.ebi.ac.uk/pdbe/search/pdb/select?q=title:*UCLEOSOM*%20AND%20status:REL&fl=pdb_id,citation_year,title,experimental_method,organism_scientific_name,molecule_name&rows=1000000&wt=json',
    lowercase = 'https://www.ebi.ac.uk/pdbe/search/pdb/select?q=title:*ucleosom*%20AND%20status:REL&fl=pdb_id,citation_year,title,experimental_method,organism_scientific_name,molecule_name&rows=1000000&wt=json'
)

# The following PDB entries have the word "nucleosome in their title, but do not
# actually contain a nucleosome, so we need to exclude them from the analysis
non_nucleosome_structures <- c(
    "1hst",
    "2z2r",
    "5x7v",
    "3uv2",
    "3fs3",
    "1wg3",
    "1nw3",
    "5ikf",
    "3gyw",
    "3gyv",
    "1ofc",
    "2ayu",
    "2iw5",
    "3hfd"
)

# This is a helper pipeline to extract data
dig_up_data <- . %>%
    .$response %>%
    .$docs %>%
    as_tibble()

# Query the PDB and clean up data
pdb_data <- pdb_queries %>% 
    map(fromJSON) %>% 
    map(dig_up_data) %>% 
    bind_rows() %>% 
    filter(!(pdb_id %in% non_nucleosome_structures)) %>% 
    mutate(experimental_method      = as_factor(as.character(experimental_method)),
           citation_year            = as.integer(citation_year),
           molecule_name            = as.character(molecule_name))

# Make figure
nucleosome_structures_year <- pdb_data %>% 
    distinct(pdb_id, .keep_all = TRUE) %>% 
    ggplot() +
    geom_bar(mapping = aes(x = citation_year, fill = experimental_method)) +
    guides(fill = guide_legend(title = "Experimental method")) +
    ggtitle("Structures of nucleosomes by year") +
    xlab("Publication year") +
    ylab("Number of PDB entries") +
    theme_bw()
ggplotly(nucleosome_structures_year)
```

```{r Save SVG file of year graph, include=FALSE}
# Save figure for download
if (!dir.exists(here("figures"))) {
    dir.create(here("figures"))
}
ggsave(filename = "nucleosome-structures-by-year.svg",
       plot = nucleosome_structures_year,
       device = "svg",
       path = here("figures"))
```

[**Download figure in SVG format**](figures/nucleosome-structures-by-year.svg)

## Nucleosome structures by experimental method

```{r Nucleosome structures by experimental method}
nucleosome_structures_method <- pdb_data %>% 
    distinct(pdb_id, .keep_all = TRUE) %>% 
    ggplot() +
    geom_bar(mapping = aes(x = experimental_method, fill = experimental_method)) +
    guides(fill = guide_legend(title = "Experimental method")) +
    ggtitle("Structures of nucleosomes by experimental method") +
    xlab("") +
    ylab("Number of PDB entries") +
    theme_bw()
ggplotly(nucleosome_structures_method)
```

```{r Save SVG file of method graph, include=FALSE}
# Save figure for download
if (!dir.exists(here("figures"))) {
    dir.create(here("figures"))
}
ggsave(filename = "nucleosome-structures-by-method.svg",
       plot = nucleosome_structures_method,
       device = "svg",
       path = here("figures"))
```

[**Download figure in SVG format**](figures/nucleosome-structures-by-method.svg)

## Nucleosome structures by histone species
### Crystal structures of nucleosomes by histone species

```{r Crystal structures of nucleosomes by histone species}
nucleosome_xtal_species <- pdb_data %>% 
    filter(experimental_method == "X-ray diffraction") %>% 
    mutate(is_histone = str_detect(molecule_name, pattern = "Histone H")) %>% 
    filter(is_histone == TRUE) %>% 
    distinct(pdb_id, .keep_all = TRUE) %>% 
    mutate(organism_scientific_name = as_factor(as.character(organism_scientific_name))) %>% 
    ggplot() +
    geom_bar(mapping = aes(x = organism_scientific_name,
                           fill = organism_scientific_name)) +
    guides(fill = guide_legend(title = "Histone species")) +
    ggtitle("Crystal structures of nucleosomes by histone species") +
    xlab("") +
    ylab("Number of PDB entries") +
    theme_bw() +
    theme(axis.text.x = element_text(angle = 30, hjust = 1))
ggplotly(nucleosome_xtal_species)
```

```{r Save SVG file of crystal-species graph, include=FALSE}
# Save figure for download
if (!dir.exists(here("figures"))) {
    dir.create(here("figures"))
}
ggsave(filename = "nucleosome-xtal-structures-by-histone-species.svg",
       plot = nucleosome_xtal_species,
       device = "svg",
       path = here("figures"))
```

[**Download figure in SVG format**](figures/nucleosome-xtal-structures-by-histone-species.svg)

### Cryo-EM structures of nucleosomes by histone species

```{r Cryo-EM structures of nucleosomes by histone species}
nucleosome_cryoem_species <- pdb_data %>% 
    filter(experimental_method == "Electron Microscopy") %>% 
    mutate(is_histone = str_detect(molecule_name, pattern = "Histone H")) %>% 
    filter(is_histone == TRUE) %>% 
    distinct(pdb_id, .keep_all = TRUE) %>% 
    mutate(organism_scientific_name = as_factor(as.character(organism_scientific_name))) %>% 
    ggplot() +
    geom_bar(mapping = aes(x = organism_scientific_name,
                           fill = organism_scientific_name)) +
    guides(fill = guide_legend(title = "Histone species")) +
    ggtitle("Cryo-EM structures of nucleosomes by histone species") +
    xlab("") +
    ylab("Number of PDB entries") +
    theme_bw() +
    theme(axis.text.x = element_text(angle = 30, hjust = 1))
ggplotly(nucleosome_cryoem_species)
```

```{r Save SVG file of cryoem-species graph, include=FALSE}
# Save figure for download
if (!dir.exists(here("figures"))) {
    dir.create(here("figures"))
}
ggsave(filename = "nucleosome-cryoem-structures-by-histone-species.svg",
       plot = nucleosome_cryoem_species,
       device = "svg",
       path = here("figures"))
```

[**Download figure in SVG format**](figures/nucleosome-cryoem-structures-by-histone-species.svg)

## Dataset

The bar graphs presented above are derived from the following dataset:

```{r Entire dataset}
# Format table for display
pdb_table <- pdb_data %>% 
    distinct(pdb_id, .keep_all = TRUE) %>% 
    arrange(desc(citation_year)) %>% 
    select(`PDB code` = pdb_id,
           `Citation year` = citation_year,
           `Experimental method` = experimental_method,
           Title = title)
pdb_table
```
